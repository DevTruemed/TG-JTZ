<!--================================-->
<!--Modal Agregar Cliente ==========-->
<!--================================-->
<div class="modal fade" id="Add" tabindex="-1" aria-labelledby="Add" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <form class="modal-content" [formGroup]="formulario" (ngSubmit)="agregarCliente()">
            <div class="modal-header">
                <h5 class="modal-title" id="addProductLabel">Add Customer</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                    (click)="reiniciarModals()"></button>
            </div>
            <div class="modal-body">
                <div class="row gx-3">
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Code</label>
                        <input type="text" class="form-control" formControlName="id" readonly>
                    </div>
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Customer</label>
                        <input type="text" class="form-control" [class.is-invalid]="isValid(formulario,'cliente')"
                            formControlName="cliente">
                        <div class="invalid-feedback" *ngIf="isValid(formulario,'cliente')">
                            this field is required ( 3 - 300 characteres )
                        </div>
                    </div>
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Phone number</label>
                        <input type="number" class="form-control" [class.is-invalid]="isValid(formulario,'telefono')"
                            formControlName="telefono">
                        <div class="invalid-feedback" *ngIf="isValid(formulario,'telefono')">
                            Invalid field
                        </div>
                    </div>
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Email</label>
                        <input type="text" class="form-control" [class.is-invalid]="isValid(formulario,'correo')"
                            formControlName="correo">
                        <div class="invalid-feedback" *ngIf="isValid(formulario,'correo')">
                            this field is required ( 5 - 200 characteres )
                        </div>
                    </div>
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Contact Name</label>
                        <input type="text" class="form-control" [class.is-invalid]="isValid(formulario,'contacto')"
                            formControlName="contacto">
                        <div class="invalid-feedback" *ngIf="isValid(formulario,'contacto')">
                            this field is required ( 3 - 200 characteres )
                        </div>
                    </div>
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-control" [class.is-invalid]="isValid(formulario,'direccion')"
                            formControlName="direccion">
                        <div class="invalid-feedback" *ngIf="isValid(formulario,'direccion')">
                            this field is required ( 3 - 300 characteres )
                        </div>
                    </div>
                    <div class="mb-3 col-12 col-sm-6 col-md-3">
                        <label class="form-label">Balance</label>
                        <input type="number" class="form-control" [class.is-invalid]="isValid(formulario,'saldo')"
                            [readOnly]="update != null" formControlName="saldo">
                        <div class="form-txt" *ngIf="!isValid(formulario,'saldo')">If there is a positive balance</div>
                        <div class="invalid-feedback" *ngIf="isValid(formulario,'saldo')">
                            this field is required ( must be positive or 0 )
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="closeModal"
                    (click)="reiniciarModals()">Close</button>
                <button type="submit" class="btn btn-primary">Save changes</button>
            </div>
        </form>
    </div>
</div>

<button class="btn btn-outline-secondary d-none" data-bs-toggle="modal" data-bs-target="#ArchivesModal"
    id="openArchivosModal"></button>
<app-archivos [archivos]="documentacion" (uploadFiles)="subirArchivos($event)"></app-archivos>

<div class="d-flex">
    <app-sidebar #sideBar></app-sidebar>
    <app-navbar (sideBar)="openSideBar()" [nombreModulo]="'Customers'"></app-navbar>
    <div class="container-fluid">
        <div style="height: 50px;" class="mb-2"></div>
        <div class="row g-2">
            <div class="col-12">
                <div class="card ">
                    <div class="card-body ">
                        <div class="d-flex justify-content-between">
                            <h5 class="card-title mb-3">Active Customers</h5>
                            <div class="ms-auto">
                                <button class="btn btn-outline-secondary btn-sm" title="Add" data-bs-toggle="modal"
                                    data-bs-target="#Add" id="addButton">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                        <div style="overflow-x: scroll;">
                            <table class="table table-striped table-bordered text-center">
                                <thead class="bg-secondary text-white">
                                    <tr>
                                        <th scope="col">Code</th>
                                        <th scope="col">Customer</th>
                                        <th scope="col">Phone number</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Address</th>
                                        <th scope="col">Balance</th>
                                        <th scope="col">Actions</th>
                                    </tr>
                                </thead>
                                <tbody [ngStyle]="{ 'max-height' : height/3+'px' }" class="contenedor">
                                    <tr *ngFor="let cliente of clientes; let i=index">
                                        <td>{{(cliente.id | number: '4.0-0') | code}}</td>
                                        <td>{{cliente.cliente}}</td>
                                        <td>{{cliente.telefono}}</td>
                                        <td>{{cliente.correo}}</td>
                                        <td>{{cliente.direccion}}</td>
                                        <td class="fw-bold"
                                            [class]="(cliente.saldo >= 0) ? 'text-success' : 'text-danger'">
                                            {{numeroAbsoluto(cliente.saldo) | currency}}
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary m-auto m-1" type="button"
                                                title="update" (click)="prepararUpdate(i)">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button class="btn btn-sm btn-outline-danger m-1" type="button"
                                                title="inactivate" (click)="desactivarCliente(i)">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm m-1"
                                                title="Customer Documents" (click)="documentosModal(i)">
                                                <i class="fas fa-folder-open"></i>
                                            </button>
                                            <button *ngIf="cliente.usuario; else noLogin"
                                                class="btn btn-outline-success btn-sm m-1" title="Show Login"
                                                (click)="mostrarUsuario(i)">
                                                <i class="far fa-address-card"></i>
                                            </button>
                                            <ng-template #noLogin>
                                                <button class="btn btn-outline-info btn-sm m-1" title="Generate Login"
                                                    (click)="generarLogin(i)">
                                                    <i class="fas fa-user-plus"></i>
                                                </button>
                                            </ng-template>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>